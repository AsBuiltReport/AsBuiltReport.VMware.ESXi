<p align="center">
    <a href="https://www.powershellgallery.com/packages/AsBuiltReport.VMware.ESXi/" alt="PowerShell Gallery Version">
        <img src="https://img.shields.io/powershellgallery/v/AsBuiltReport.VMware.ESXi.svg" /></a>
    <a href="https://www.powershellgallery.com/packages/AsBuiltReport.VMware.ESXi/" alt="PS Gallery Downloads">
        <img src="https://img.shields.io/powershellgallery/dt/AsBuiltReport.VMware.ESXi.svg" /></a>
    <a href="https://www.powershellgallery.com/packages/AsBuiltReport.VMware.ESXi/" alt="PS Platform">
        <img src="https://img.shields.io/powershellgallery/p/AsBuiltReport.VMware.ESXi.svg" /></a>
</p>
<p align="center">
    <a href="https://github.com/AsBuiltReport/AsBuiltReport.VMware.ESXi/graphs/commit-activity" alt="GitHub Last Commit">
        <img src="https://img.shields.io/github/last-commit/AsBuiltReport/AsBuiltReport.VMware.ESXi/master.svg" /></a>
    <a href="https://raw.githubusercontent.com/AsBuiltReport/AsBuiltReport.VMware.ESXi/master/LICENSE" alt="GitHub License">
        <img src="https://img.shields.io/github/license/AsBuiltReport/AsBuiltReport.VMware.ESXi.svg" /></a>
    <a href="https://github.com/AsBuiltReport/AsBuiltReport.VMware.ESXi/graphs/contributors" alt="GitHub Contributors">
        <img src="https://img.shields.io/github/contributors/AsBuiltReport/AsBuiltReport.VMware.ESXi.svg"/></a>
</p>
<p align="center">
    <a href="https://twitter.com/AsBuiltReport" alt="Twitter">
            <img src="https://img.shields.io/twitter/follow/AsBuiltReport.svg?style=social"/></a>
</p>

# AsBuiltReport.VMware.ESXi

# Getting Started
Below are the instructions on how to install, configure and generate a VMware ESXi As Built report.

## Supported ESXi Versions
The VMware ESXi As Built Report supports the following ESXi versions;
- ESXi 5.0
- ESXi 5.1
- ESXi 5.5
- ESXi 6.0
- ESXi 6.5
- ESXi 6.7

## Pre-requisites
The following PowerShell modules are required for generating a VMware ESXi As Built report.

Each of these modules can be easily downloaded and installed via the PowerShell Gallery 

- [VMware PowerCLI Module](https://www.powershellgallery.com/packages/VMware.PowerCLI/)
- [AsBuiltReport.VMware.ESXi Module](https://www.powershellgallery.com/packages/AsBuiltReport.VMware.ESXi/)

## Module Installation

Open a Windows PowerShell terminal window and install each of the required modules. 

**Note:** VMware PowerCLI 10.0 or higher required.

```powershell
install-module VMware.PowerCLI -MinimumVersion 10.0
install-module AsBuiltReport.VMware.ESXi
```

### Required Privileges
Administrator/root privileges are required on the ESXi host to generate a VMware ESXi As Built Report.

## Configuration

The ESXi As Built Report utilises a JSON file to allow configuration of report information, options, detail and healthchecks.

An ESXi report configuration file can be generated by executing the following command;

New-AsBuiltReportConfig -Report VMware.ESXi -Path <User specified folder> -Name <Optional> 

Executing this command will copy the default ESXi report JSON configuration to a user specified folder.

All report settings can then be configured via the JSON file.

The following provides information of how to configure each schema within the report's JSON file.

### Report
The **Report** sub-schema provides configuration of the ESXi report information

| Schema | Sub-Schema | Description |
| ------ | ---------- | ----------- |
| Report | Name | The name of the As Built Report
| Report | Version | The report version
| Report | Status | The report release status

### Options
The **Options** sub-schema allows certain options within the report to be toggled on or off

| Schema | Sub-Schema | Setting | Description |
| ------ | ---------- | ------- | ----------- |
| Options | ShowLicenseKeys | true / false | Toggle to mask/unmask ESXi license keys<br><br> **Masked License Key**<br>\*\*\*\*\*-\*\*\*\*\*-\*\*\*\*\*-56YDM-AS12K<br><br> **Unmasked License Key**<br>AKLU4-PFG8M-W2D8J-56YDM-AS12K
| Options | ShowVMSnapshots | true / false | Toggle to enable/disable reporting of VM snapshots

### InfoLevel
The **InfoLevel** sub-schema allows configuration of each section of the report at a granular level. The following sections can be set

| Schema | Sub-Schema | Default Setting |
| ------ | ---------- | --------------- |
| InfoLevel | VMHost | 3
| InfoLevel | Network | 3
| InfoLevel | Datastore | 3
| InfoLevel | VM | 3

There are 6 levels (0-5) of detail granularity for each section as follows;

| Setting | InfoLevel | Description |
| ------- | ---- | ----------- |
| 0 | Disabled | does not collect or display any information
| 1 | Summary | provides summarised information for a collection of objects
| 2 | Informative | provides condensed, detailed information for a collection of objects
| 3 | Detailed | provides detailed information for individual objects
| 4 | Adv Detailed | provides detailed information for individual objects, as well as information for associated objects (Hosts, Datastores, VMs etc)
| 5 | Comprehensive | provides comprehensive information for individual objects, such as advanced configuration settings

### Healthcheck
The **Healthcheck** sub-schema is used to toggle health checks on or off.

#### VMHost
The **VMHost** sub-schema is used to configure health checks for VMHosts.

| Schema | Sub-Schema | Setting | Description | Highlight |
| ------ | ---------- | ------- | ----------- | --------- |
| VMHost | ConnectionState | true / false | Highlights VMHosts connection state | ![Warning](https://placehold.it/15/FFE860/000000?text=+) Maintenance<br>  ![Critical](https://placehold.it/15/FFB38F/000000?text=+)  Disconnected
| VMHost | HyperThreading | true / false | Highlights VMHosts which have HyperThreading disabled | ![Warning](https://placehold.it/15/FFE860/000000?text=+) HyperThreading disabled<br> 
| VMHost | ScratchLocation | true / false | Highlights VMHosts which are configured with the default scratch location | ![Warning](https://placehold.it/15/FFE860/000000?text=+) Scratch location is /tmp/scratch
| VMHost | IPv6 | true / false | Highlights VMHosts which do not have IPv6 enabled | ![Warning](https://placehold.it/15/FFE860/000000?text=+) IPv6 disabled
| VMHost | UpTimeDays | true / false | Highlights VMHosts with uptime days greater than 9 months | ![Warning](https://placehold.it/15/FFE860/000000?text=+) 9 - 12 months<br> ![Critical](https://placehold.it/15/FFB38F/000000?text=+)  >12 months
| VMHost | Licensing | true / false | Highlights VMHosts which are using production evaluation licenses | ![Warning](https://placehold.it/15/FFE860/000000?text=+) Product evaluation license in use
| VMHost | SSH | true / false | Highlights if the SSH service is enabled | ![Warning](https://placehold.it/15/FFE860/000000?text=+) TSM / TSM-SSH service enabled
| VMHost | ESXiShell | true / false | Highlights if the ESXi Shell service is enabled | ![Warning](https://placehold.it/15/FFE860/000000?text=+) TSM / TSM-EsxiShell service enabled
| VMHost | NTP | true / false | Highlights if the NTP service has stopped or is disabled on a VMHost | ![Critical](https://placehold.it/15/FFB38F/000000?text=+)  NTP service stopped / disabled
| VMHost | StorageAdapter | true / false | Highlights storage adapters which are not 'Online' | ![Warning](https://placehold.it/15/FFE860/000000?text=+) Storage adapter status is 'Unknown'<br> ![Critical](https://placehold.it/15/FFB38F/000000?text=+)  Storage adapter status is 'Offline'
| VMHost | NetworkAdapter | true / false | Highlights physical network adapters which are not 'Connected'<br> Highlights physical network adapters which are 'Down' | ![Critical](https://placehold.it/15/FFB38F/000000?text=+)  Network adapter is 'Disconnected'<br> ![Critical](https://placehold.it/15/FFB38F/000000?text=+)  Network adapter is 'Down'
| VMHost | LockdownMode | true / false | Highlights VMHosts which do not have Lockdown mode enabled | ![Warning](https://placehold.it/15/FFE860/000000?text=+) Lockdown Mode disabled<br>

#### Datastore
The **Datastore** sub-schema is used to configure health checks for Datastores.

| Schema | Sub-Schema | Setting | Description | Highlight |
| ------ | ---------- | ------- | ----------- | --------- |
| Datastore | CapacityUtilization | true / false | Highlights datastores with storage capacity utilization over 75% | ![Warning](https://placehold.it/15/FFE860/000000?text=+) 75 - 90% utilized<br> ![Critical](https://placehold.it/15/FFB38F/000000?text=+) >90% utilized

#### VM
The **VM** sub-schema is used to configure health checks for virtual machines.

| Schema | Sub-Schema | Setting | Description | Highlight |
| ------ | ---------- | ------- | ----------- | --------- |
| VM | PowerState | true / false | Enables/Disables checking if the VM is powered on | ![Warning](https://placehold.it/15/FFE860/000000?text=+) VM is powered off
| VM | ConnectionState | true / false | Enables/Disables checking if the VM is orphaned or inaccessible | ![Critical](https://placehold.it/15/FFB38F/000000?text=+) VM is orphaned or inaccessible
| VM | CpuHotAdd | true / false | Highlights virtual machines which have CPU Hot Add enabled | ![Warning](https://placehold.it/15/FFE860/000000?text=+) CPU Hot Add enabled
| VM | CpuHotRemove | true / false | Highlights virtual machines which have CPU Hot Remove enabled | ![Warning](https://placehold.it/15/FFE860/000000?text=+) CPU Hot Remove enabled
| VM | MemoryHotAdd | true / false | Highlights VMs which have Memory Hot Add enabled | ![Warning](https://placehold.it/15/FFE860/000000?text=+) Memory Hot Add enabled
| VM | ChangeBlockTracking | true / false | Highlights VMs which do not have Change Block Tracking enabled | ![Warning](https://placehold.it/15/FFE860/000000?text=+) Change Block Tracking disabled
| VM | SpbmPolicyCompliance | true / false | Highlights VMs which do not comply with storage based policies | ![Warning](https://placehold.it/15/FFE860/000000?text=+) VM storage based policy compliance is unknown<br> ![Critical](https://placehold.it/15/FFB38F/000000?text=+) VM does not comply with storage based policies
| VM | VMToolsStatus | true / false | Highlights Virtual Machines which do not have VM Tools installed, are out of date or are not running | ![Warning](https://placehold.it/15/FFE860/000000?text=+) VM Tools not installed, out of date or not running
| VM | VMSnapshots | true / false | Highlights Virtual Machines which have snapshots older than 7 days | ![Warning](https://placehold.it/15/FFE860/000000?text=+) VM Snapshot age >= 7 days<br> ![Critical](https://placehold.it/15/FFB38F/000000?text=+) VM Snapshot age >= 14 days

## Examples 

```powershell
# Generate an ESXi As Built Report for ESXi server 'esxi-01.corp.local' using specified credentials. Export report to HTML & DOCX formats. Use default report style. Append timestamp to report filename. Save reports to 'C:\Users\Tim\Documents'
PS C:\> New-AsBuiltReport -Report VMware.ESXi -Target 'esxi-01.corp.local' -Username 'root' -Password 'VMware1!' -Format Html,Word -OutputPath 'C:\Users\Tim\Documents' -Timestamp

# Generate an ESXi As Built Report for ESXi server 'esxi-01.corp.local' using specified credentials and report configuration file. Export report to Text, HTML & DOCX formats. Use default report style. Save reports to 'C:\Users\Tim\Documents'. Display Verbose messages to the console.
PS C:\> New-AsBuiltReport -Report VMware.ESXi -Target 'esxi-01.corp.local' -Username 'root' -Password 'VMware1!' -Format Text,Html,Word -OutputPath 'C:\Users\Tim\Documents' -ReportConfigPath 'C:\Users\Tim\AsBuiltReport\AsBuiltReport.VMware.ESXi.json' -Verbose

# Generate an ESXi As Built Report for ESXi server 'esxi-01.corp.local' using stored credentials. Export report to HTML & Text formats. Use default report style. Highlight environment issues within the report. Save reports to 'C:\Users\Tim\Documents'.
PS C:\> $Creds = Get-Credential
PS C:\> New-AsBuiltReport -Report VMware.ESXi -Target 'esxi-01.corp.local' -Credential $Creds -Format Html,Text -OutputPath 'C:\Users\Tim\Documents' -EnableHealthCheck

# Generate a single ESXi As Built Report for ESXi servers 'esxi-01.corp.local' and 'esxi-02.corp.local' using specified credentials. Report exports to Word format by default. Apply custom style to the report. Reports are saved to the user profile folder by default.
PS C:\> New-AsBuiltReport -Report VMware.ESXi -Target 'esxi-01.corp.local','esxi-02.corp.local' -Username 'root' -Password 'VMware1!' -StylePath C:\Scripts\Styles\MyCustomStyle.ps1

# Generate an ESXi As Built Report for ESXi server 'vcenter-01.corp.local' using specified credentials. Export report to HTML & DOCX formats. Use default report style. Reports are saved to the user profile folder by default. Attach and send reports via e-mail.
PS C:\> New-AsBuiltReport -Report VMware.ESXi -Target 'esxi-01.corp.local' -Username 'root' -Password 'VMware1!' -Format Html,Word -OutputPath C:\Users\Tim\Documents -SendEmail
```